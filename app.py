import streamlit as st
import time
import random

# --- í˜ì´ì§€ ì„¤ì • ---
st.set_page_config(page_title="ê³¼í•™ ë°©íƒˆì¶œ: ë¼ìŠ¤íŠ¸ ì½”ë“œ", page_icon="ğŸ§©", layout="wide")

# --- ìŠ¤íƒ€ì¼ (ë°©íƒˆì¶œ ë¶„ìœ„ê¸° & ìª½ì§€ ì• ë‹ˆë©”ì´ì…˜) ---
st.markdown("""
<style>
    .big-font { font-size: 20px !important; font-weight: bold; }
    
    /* êµ¬ì—­ ì¹´ë“œ */
    .zone-card {
        background-color: #262730;
        border: 2px solid #4B4B4B;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        margin-bottom: 10px;
    }
    
    /* í´ë¦¬ì–´ ëœ êµ¬ì—­ ì•”í˜¸ í‘œì‹œ */
    .cleared-password {
        font-family: 'Courier New', monospace;
        font-size: 24px;
        color: #00FF00;
        font-weight: bold;
        background-color: #000;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #00FF00;
        margin-top: 10px;
    }

    /* ìª½ì§€ (Meta Puzzle) */
    .secret-note {
        background-color: #FFF8DC;
        color: #5D4037;
        padding: 20px;
        border-radius: 5px;
        border: 2px dashed #8D6E63;
        font-family: 'Courier New', monospace;
        margin-top: 20px;
        box-shadow: 5px 5px 15px rgba(0,0,0,0.3);
        animation: fadeIn 2s;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
</style>
""", unsafe_allow_html=True)

# =========================================================
# 1. ë¬¸ì œ ì€í–‰ (ìˆ˜ì •ë¨: 'ê±°ë¦„' ì •ë‹µ ë¬¸ì œ ì‚­ì œ, ì¬ê²°ì • ìœ ì§€)
# =========================================================
PROBLEM_POOL = {
    1: [ # í˜¼í•©ë¬¼ì˜ ë¶„ë¦¬ (ê±°ë¦„ ì‚­ì œ / ì¬ê²°ì • í¬í•¨)
        {"q": "ë¬¼ê³¼ ì‹ìš©ìœ ì²˜ëŸ¼ ì„œë¡œ ì„ì´ì§€ ì•Šê³  ë°€ë„ê°€ ë‹¤ë¥¸ ì•¡ì²´ í˜¼í•©ë¬¼ì„ ë¶„ë¦¬í•˜ëŠ” ì‹¤í—˜ ê¸°êµ¬ëŠ”?", "a": "ë¶„ë³„ê¹”ë•Œê¸°"},
        {"q": "ë°”ë‹·ë¬¼ì„ ë“ì—¬ì„œ ë‚˜ì˜¤ëŠ” ìˆ˜ì¦ê¸°ë¥¼ ëƒ‰ê°ì‹œì¼œ ìˆœìˆ˜í•œ ë¬¼ì„ ì–»ëŠ” ë°©ë²•ì€?", "a": "ì¦ë¥˜"},
        {"q": "ê²€ì€ìƒ‰ ì‚¬ì¸íœ ì‰í¬ì˜ ìƒ‰ì†Œë¥¼ ë¶„ë¦¬í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€? (ì´ë™ ì†ë„ ì°¨ì´)", "a": "í¬ë¡œë§ˆí† ê·¸ë˜í”¼"},
        {"q": "ë†’ì€ ì˜¨ë„ì—ì„œ ê³ ì²´ë¥¼ ë…¹ì¸ í›„ ì„œì„œíˆ ì‹í˜€ ìˆœìˆ˜í•œ ê²°ì •ì„ ì–»ëŠ” ë°©ë²•ì€?", "a": "ì¬ê²°ì •"},
        {"q": "ì›ìœ ë¥¼ ê°€ì—´í•˜ì—¬ ë“ëŠ”ì  ì°¨ì´ì— ë”°ë¼ ë“±ìœ , ê²½ìœ  ë“±ìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ê±°ëŒ€í•œ íƒ‘ì€?", "a": "ì¦ë¥˜íƒ‘"},
        {"q": "ì¢‹ì€ ë³ì”¨ë¥¼ ê³ ë¥´ê¸° ìœ„í•´ ì†Œê¸ˆë¬¼ì— ë‹´ê·¸ëŠ” ê²ƒì€ ë¬¼ì§ˆì˜ ì–´ë–¤ ì°¨ì´ë¥¼ ì´ìš©í•œ ê²ƒì¸ê°€?", "a": "ë°€ë„"},
        {"q": "ë¬¼ê³¼ ì—íƒ„ì˜¬ í˜¼í•©ë¬¼ì„ ê°€ì—´í•  ë•Œ ë“ëŠ”ì ì´ ë‚®ì€ ì—íƒ„ì˜¬ì´ ë¨¼ì € ë‚˜ì˜¤ëŠ” ë¶„ë¦¬ ë°©ë²•ì€?", "a": "ë¶„ë³„ì¦ë¥˜"},
        {"q": "íƒí•œ ìˆ ì„ ê°€ì—´í•˜ì—¬ ë§‘ì€ ì†Œì£¼ë¥¼ ì–»ëŠ” ê¸°êµ¬ì¸ ì†Œì£¼ ê³ ë¦¬ëŠ” ë¬¼ì§ˆì˜ ì–´ë–¤ ì°¨ì´ë¥¼ ì´ìš©í•˜ëŠ”ê°€?", "a": "ë“ëŠ”ì "},
        {"q": "ìŠ¤íƒ€ì´ë¡œí¼ê³¼ ëª¨ë˜ê°€ ì„ì—¬ ìˆì„ ë•Œ ë¬¼ì„ ë¶€ì–´ ëœ¨ëŠ” ê²ƒì„ ê±´ì ¸ë‚´ëŠ” ë¶„ë¦¬ ë°©ë²•ì€ ì–´ë–¤ ì°¨ì´ ë•Œë¬¸ì¸ê°€?", "a": "ë°€ë„"},
        {"q": "ë„í•‘ í…ŒìŠ¤íŠ¸ì—ì„œ ì•½ë¬¼ì„ ë¶„ë¦¬í•˜ê±°ë‚˜ ìì˜ ìƒ‰ì†Œë¥¼ ë¶„ë¦¬í•  ë•Œ ì“°ëŠ” ê°€ì¥ íš¨ê³¼ì ì¸ ë°©ë²•ì€?", "a": "í¬ë¡œë§ˆí† ê·¸ë˜í”¼"},
        {"q": "ì§ˆì‚° ì¹¼ë¥¨ì— ì„ì¸ ì†ŒëŸ‰ì˜ í™©ì‚° êµ¬ë¦¬ë¥¼ ì œê±°í•˜ê³  ìˆœìˆ˜í•œ ì§ˆì‚° ì¹¼ë¥¨ì„ ì–»ëŠ” ë°©ë²•ì€?", "a": "ì¬ê²°ì •"},
        {"q": "ë°”ë‹·ë¬¼ì—ì„œ ì‹ìˆ˜ë¥¼ ì–»ê¸° ìœ„í•´ ë“ì´ëŠ” ë°©ë²• ë§ê³ , ì–¼ìŒ(ë¹™í•˜)ì„ ì´ìš©í•˜ëŠ” ì›ë¦¬ëŠ” ë¬´ì—‡ê³¼ ë°˜ëŒ€ì¸ê°€? (ì–´ëŠ”ì /ë“ëŠ”ì )", "a": "ë“ëŠ”ì "},
        {"q": "ë¶„ë³„ ê¹”ë•Œê¸°ë¡œ ë¶„ë¦¬í•  ë•Œ ë°€ë„ê°€ í° ë¬¼ì§ˆì€ ìœ„ì™€ ì•„ë˜ ì¤‘ ì–´ë””ë¡œ ê°€ëŠ”ê°€?", "a": "ì•„ë˜"},
        {"q": "ì¦ë¥˜ ì‹¤í—˜ì—ì„œ ì•¡ì²´ê°€ ê°‘ìê¸° ë“ì–´ ë„˜ì¹˜ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´ ë„£ëŠ” ëŒì€?", "a": "ë“ì„ìª½"},
        {"q": "ë¶„ë³„ ê¹”ë•Œê¸° ì‚¬ìš© ì‹œ ìœ„ìª½ ë§ˆê°œë¥¼ ì—´ì–´ì•¼ ë‚˜ì¤‘ì— ì½•ì„ ì—´ì—ˆì„ ë•Œ ì•¡ì²´ê°€ ì˜ ë‚´ë ¤ê°„ë‹¤. ë¬´ì—‡ì´ ì‘ìš©í•˜ê¸° ë•Œë¬¸ì¸ê°€?", "a": "ëŒ€ê¸°ì••"},
        {"q": "ì²œì¼ì—¼ì„ ì–»ëŠ” ê³¼ì •ì€ í–‡ë¹›ê³¼ ë°”ëŒìœ¼ë¡œ ë¬¼ì„ ë‚ ë ¤ë³´ë‚´ëŠ” ê²ƒì´ë‹¤. ì´ë¥¼ ë¬´ì—‡ì´ë¼ í•˜ëŠ”ê°€?", "a": "ì¦ë°œ"},
        {"q": "ë¬¼ê³¼ ì—íƒ„ì˜¬ì„ ë¶„ë³„ ì¦ë¥˜í•  ë•Œ ì—íƒ„ì˜¬ì´ ë“ì–´ ë‚˜ì˜¤ëŠ” êµ¬ê°„ì˜ ì˜¨ë„ëŠ” ì¼ì •í•˜ë‹¤ê°€ ë¬¼ì´ ë“ì„ ë•Œ ë‹¤ì‹œ (ì˜¬ë¼ê°„ë‹¤/ë‚´ë ¤ê°„ë‹¤).", "a": "ì˜¬ë¼ê°„ë‹¤"},
        {"q": "ì•¡ì²´ ê³µê¸°ë¥¼ ë¶„ë¦¬í•  ë•ŒëŠ” ê³µê¸°ë¥¼ ëƒ‰ê°ì‹œì¼œ ì•¡ì²´ë¡œ ë§Œë“  í›„ 'ì´ê²ƒ' ì°¨ì´ë¥¼ ì´ìš©í•´ ë¶„ë¦¬í•œë‹¤.", "a": "ë“ëŠ”ì "},
        {"q": "ë¶€íƒ„ ê°€ìŠ¤í†µì— ë‚¨ì€ ì†ŒëŸ‰ì˜ ì•¡ì²´ ë¶€íƒ„ì„ ê¸°ì²´ë¡œ ë§Œë“¤ì–´ ë¶„ë¦¬í•˜ëŠ” ê²ƒì€ ë¬¼ì§ˆì˜ ë¬´ì—‡ì„ ì´ìš©í•œ ê²ƒì¸ê°€?", "a": "ë“ëŠ”ì "},
        {"q": "ì‚¬ê¸ˆì„ ì±„ì·¨í•  ë•Œ í”ë“¤ì–´ì„œ í™ì€ ì”»ê²¨ ë³´ë‚´ê³  ê¸ˆë§Œ ë‚¨ê¸°ëŠ” ê²ƒì€ ê¸ˆì˜ 'ì´ê²ƒ'ì´ í¬ê¸° ë•Œë¬¸ì´ë‹¤.", "a": "ë°€ë„"}
    ],
    2: [ # ìˆ˜ê¶Œê³¼ í•´ìˆ˜ì˜ ìˆœí™˜
        {"q": "ì§€êµ¬ì˜ ë¬¼(ìˆ˜ê¶Œ) ì¤‘ í•´ìˆ˜ë¥¼ ì œì™¸í•œ ë‹´ìˆ˜ì—ì„œ ê°€ì¥ ë§ì€ ë¹„ìœ¨ì„ ì°¨ì§€í•˜ëŠ” ê²ƒì€?", "a": "ë¹™í•˜"},
        {"q": "í•´ìˆ˜ 1kgì— ë…¹ì•„ ìˆëŠ” ì—¼ë¥˜ì˜ ì´ëŸ‰ì„ gìˆ˜ë¡œ ë‚˜íƒ€ë‚¸ ê²ƒì€?", "a": "ì—¼ë¶„"},
        {"q": "ì—¼ë¶„ì˜ ë‹¨ìœ„ë¡œ psuë¥¼ ì‚¬ìš©í•˜ëŠ”ë°, ì´ë¥¼ ìš°ë¦¬ë§ë¡œ í•˜ë©´?", "a": "ì‹¤ìš©ì—¼ë¶„ë‹¨ìœ„"},
        {"q": "í•´ìˆ˜ì˜ ì¸µìƒ êµ¬ì¡° ì¤‘ íƒœì–‘ ì—ë„ˆì§€ë¥¼ í¡ìˆ˜í•˜ê³  ë°”ëŒì— ì˜í•´ ì„ì—¬ ìˆ˜ì˜¨ì´ ë†’ì€ ì¸µì€?", "a": "í˜¼í•©ì¸µ"},
        {"q": "ê¹Šì–´ì§ˆìˆ˜ë¡ ìˆ˜ì˜¨ì´ ê¸‰ê²©íˆ ë‚®ì•„ì ¸ ëŒ€ë¥˜ê°€ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ” ë§¤ìš° ì•ˆì •í•œ ì¸µì€?", "a": "ìˆ˜ì˜¨ì•½ì¸µ"},
        {"q": "ì¼ ë…„ ë‚´ë‚´ ìˆ˜ì˜¨ì´ ë‚®ê³  ì¼ì •í•˜ë©°, ì „ì²´ í•´ìˆ˜ì˜ ì•½ 80%ë¥¼ ì°¨ì§€í•˜ëŠ” ì¸µì€?", "a": "ì‹¬í•´ì¸µ"},
        {"q": "ì €ìœ„ë„(ì ë„)ì—ì„œ ê³ ìœ„ë„(ê·¹)ë¡œ íë¥´ëŠ” ë”°ëœ»í•œ í•´ë¥˜ë¥¼ í†µí‹€ì–´ ë¬´ì—‡ì´ë¼ í•˜ëŠ”ê°€?", "a": "ë‚œë¥˜"},
        {"q": "ìš°ë¦¬ë‚˜ë¼ ë™í•´ì—ì„œ ë‚œë¥˜ì™€ í•œë¥˜ê°€ ë§Œë‚˜ ë¬¼ê³ ê¸°ê°€ ë§ì´ ì¡íˆëŠ” ì¢‹ì€ ì–´ì¥ì€?", "a": "ì¡°ê²½ìˆ˜ì—­"},
        {"q": "ë‹¬ê³¼ íƒœì–‘ì˜ ì¸ë ¥ì— ì˜í•´ í•´ìˆ˜ë©´ì´ ì£¼ê¸°ì ìœ¼ë¡œ ë†’ì•„ì§€ê³  ë‚®ì•„ì§€ëŠ” í˜„ìƒì€?", "a": "ì¡°ì„"},
        {"q": "ë°€ë¬¼ë¡œ ì¸í•´ í•´ìˆ˜ë©´ì´ ê°€ì¥ ë†’ì•„ì¡Œì„ ë•Œë¥¼ ë¬´ì—‡ì´ë¼ í•˜ëŠ”ê°€?", "a": "ë§Œì¡°"},
        {"q": "ì°ë¬¼ë¡œ ì¸í•´ í•´ìˆ˜ë©´ì´ ê°€ì¥ ë‚®ì•„ì¡Œì„ ë•Œë¥¼ ë¬´ì—‡ì´ë¼ í•˜ëŠ”ê°€?", "a": "ê°„ì¡°"},
        {"q": "ë§Œì¡°ì™€ ê°„ì¡°ì˜ í•´ìˆ˜ë©´ ë†’ì´ ì°¨ì´ë¥¼ ë¬´ì—‡ì´ë¼ í•˜ëŠ”ê°€?", "a": "ì¡°ì°¨"},
        {"q": "ìš°ë¦¬ë‚˜ë¼ ì£¼ë³€ í•´ë¥˜ ì¤‘, ì¿ ë¡œì‹œì˜¤ í•´ë¥˜ì—ì„œ ê°ˆë¼ì ¸ ë‚˜ì™€ ì„œí•´ë¡œ íë¥´ëŠ” ë‚œë¥˜ëŠ”?", "a": "í™©í•´ë‚œë¥˜"},
        {"q": "ìš°ë¦¬ë‚˜ë¼ ë™í•´ì•ˆì„ ë”°ë¼ ë¶ìª½ìœ¼ë¡œ íë¥´ëŠ” ë‚œë¥˜ì˜ ì´ë¦„ì€?", "a": "ë™í•œë‚œë¥˜"},
        {"q": "ë°”ëŒì´ ê°•í•˜ê²Œ ë¶ˆìˆ˜ë¡ í˜¼í•©ì¸µì˜ ë‘ê»˜ëŠ” ì–´ë–»ê²Œ ë³€í•˜ëŠ”ê°€? (ë‘êº¼ì›Œì§„ë‹¤/ì–‡ì•„ì§„ë‹¤)", "a": "ë‘êº¼ì›Œì§„ë‹¤"},
        {"q": "ìš°ë¦¬ë‚˜ë¼ ì—¬ë¦„ì²  í‘œì¸µ ì—¼ë¶„ì´ ê²¨ìš¸ì² ë³´ë‹¤ ë‚®ì€ ì£¼ëœ ì´ìœ ëŠ” ë¬´ì—‡ì´ ë§ì•„ì„œì¸ê°€?", "a": "ê°•ìˆ˜ëŸ‰"},
        {"q": "í•´ìˆ˜ì— ê°€ì¥ ë§ì´ ë…¹ì•„ ìˆëŠ” ì—¼ë¥˜ëŠ” ì—¼í™” ë‚˜íŠ¸ë¥¨ì´ë‹¤. ë‘ ë²ˆì§¸ë¡œ ë§ì€ ê²ƒì€?", "a": "ì—¼í™”ë§ˆê·¸ë„¤ìŠ˜"},
        {"q": "ì—¼í™” ë§ˆê·¸ë„¤ìŠ˜ì€ ë§›ì´ ì–´ë–¤ê°€? (ì§ ë§›/ì“´ë§›)", "a": "ì“´ë§›"},
        {"q": "ì „ ì„¸ê³„ í•´ìˆ˜ì˜ í‰ê·  ì—¼ë¶„ì€ ì•½ ëª‡ psuì¸ê°€? (ìˆ«ìë§Œ)", "a": "35"},
        {"q": "ë™í•´, í™©í•´, ë‚¨í•´ ì¤‘ ì¡°ì°¨ê°€ ê°€ì¥ ì»¤ì„œ ê°¯ë²Œì´ ì˜ ë°œë‹¬í•œ ê³³ì€?", "a": "í™©í•´"}
    ],
    3: [ # ì—´ê³¼ ìš°ë¦¬ ìƒí™œ
        {"q": "ê³ ì²´ì—ì„œ ì…ìì˜ ì¶©ëŒì„ í†µí•´ ì—´ì´ ì „ë‹¬ë˜ëŠ” í˜„ìƒì€?", "a": "ì „ë„"},
        {"q": "ì•¡ì²´ë‚˜ ê¸°ì²´ ìƒíƒœì˜ ì…ìê°€ ì§ì ‘ ì´ë™í•˜ë©´ì„œ ì—´ì„ ì „ë‹¬í•˜ëŠ” í˜„ìƒì€?", "a": "ëŒ€ë¥˜"},
        {"q": "ë¬¼ì§ˆì˜ ë„ì›€ ì—†ì´ ì—´ì´ ì „ìê¸°íŒŒ(ë¹›) í˜•íƒœë¡œ ì§ì ‘ ì „ë‹¬ë˜ëŠ” í˜„ìƒì€?", "a": "ë³µì‚¬"},
        {"q": "ì–´ë–¤ ë¬¼ì§ˆ 1kgì˜ ì˜¨ë„ë¥¼ 1â„ƒ ë†’ì´ëŠ” ë° í•„ìš”í•œ ì—´ëŸ‰ì€?", "a": "ë¹„ì—´"},
        {"q": "ì˜¨ë„ê°€ ë‹¤ë¥¸ ë‘ ë¬¼ì²´ê°€ ì ‘ì´‰í–ˆì„ ë•Œ ì˜¨ë„ê°€ ê°™ì•„ì ¸ ë” ì´ìƒ ì—´ì˜ ì´ë™ì´ ì—†ëŠ” ìƒíƒœëŠ”?", "a": "ì—´í‰í˜•"},
        {"q": "ì˜¨ë„ê°€ ë†’ì•„ì§€ë©´ ë¬¼ì§ˆì˜ ê¸¸ì´ë‚˜ ë¶€í”¼ê°€ ëŠ˜ì–´ë‚˜ëŠ” í˜„ìƒì€?", "a": "ì—´íŒ½ì°½"},
        {"q": "ë‚®ì— í•´ì•ˆê°€ì—ì„œ ìœ¡ì§€ê°€ ë°”ë‹¤ë³´ë‹¤ ë¹¨ë¦¬ ê°€ì—´ë˜ì–´ ë°”ë‹¤ì—ì„œ ìœ¡ì§€ë¡œ ë¶€ëŠ” ë°”ëŒì€?", "a": "í•´í’"},
        {"q": "ë°¤ì— ìœ¡ì§€ê°€ ë°”ë‹¤ë³´ë‹¤ ë¹¨ë¦¬ ì‹ì–´ì„œ ìœ¡ì§€ì—ì„œ ë°”ë‹¤ë¡œ ë¶€ëŠ” ë°”ëŒì€?", "a": "ìœ¡í’"},
        {"q": "ì—´íŒ½ì°½ ì •ë„ê°€ ë‹¤ë¥¸ ë‘ ê¸ˆì†ì„ ë¶™ì—¬, ì˜¨ë„ì— ë”°ë¼ íœ˜ì–´ì§€ê²Œ ë§Œë“  ì¥ì¹˜ëŠ”?", "a": "ë°”ì´ë©”íƒˆ"},
        {"q": "ë¬¼ì€ ë¹„ì—´ì´ ì»¤ì„œ ì˜¨ë„ê°€ ì²œì²œíˆ ë³€í•œë‹¤. ìš°ë¦¬ ëª¸ì˜ 70%ê°€ ë¬¼ì´ë¼ì„œ ì¢‹ì€ ì ì€ [ ?? ] ìœ ì§€ì— ìœ ë¦¬í•˜ë‹¤.", "a": "ì²´ì˜¨"},
        {"q": "ì—ì–´ì»¨ì„ ìœ„ìª½ì— ì„¤ì¹˜í•˜ëŠ” ì´ìœ ëŠ” ì°¬ ê³µê¸°ê°€ ì•„ë˜ë¡œ ë‚´ë ¤ê°€ëŠ” ë¬´ìŠ¨ í˜„ìƒ ë•Œë¬¸ì¸ê°€?", "a": "ëŒ€ë¥˜"},
        {"q": "ê²¨ìš¸ì²  ì†œì´ë¶ˆì´ ë”°ëœ»í•œ ì´ìœ ëŠ” ì†œ ì‚¬ì´ì— í¬í•¨ëœ 'ì´ê²ƒ'ì´ ì—´ì „ë„ë¥¼ ë§‰ê¸° ë•Œë¬¸ì´ë‹¤.", "a": "ê³µê¸°"},
        {"q": "ì—´ì€ í•­ìƒ ì˜¨ë„ê°€ [ ?? ] ê³³ì—ì„œ ë‚®ì€ ê³³ìœ¼ë¡œ ì´ë™í•œë‹¤.", "a": "ë†’ì€"},
        {"q": "í”„ë¼ì´íŒ¬ì˜ ì†ì¡ì´ë¥¼ í”Œë¼ìŠ¤í‹±ì´ë‚˜ ë‚˜ë¬´ë¡œ ë§Œë“œëŠ” ê²ƒì€ ì—´ì˜ ë¬´ì—‡ì„ ë§‰ê¸° ìœ„í•¨ì¸ê°€?", "a": "ì „ë„"},
        {"q": "íƒœì–‘ì—´ì´ ì§„ê³µ ìƒíƒœì¸ ìš°ì£¼ë¥¼ í†µê³¼í•´ ì§€êµ¬ë¡œ ì˜¤ëŠ” ë°©ë²•ì€?", "a": "ë³µì‚¬"},
        {"q": "ë°”ì´ë©”íƒˆì—ì„œ ì—´ì„ ê°€í–ˆì„ ë•Œ íœ˜ì–´ì§€ëŠ” ë°©í–¥ì€ ì—´íŒ½ì°½ì´ [ ?? ] ìª½ì´ë‹¤. (í°/ì‘ì€)", "a": "ì‘ì€"},
        {"q": "ê¸°ì°¨ ì„ ë¡œ ì‚¬ì´ì— í‹ˆì„ ë‘ëŠ” ì´ìœ ëŠ” ì—¬ë¦„ì²  ë¬´ì—‡ì— ì˜í•œ ì‚¬ê³ ë¥¼ ë§‰ê¸° ìœ„í•¨ì¸ê°€?", "a": "ì—´íŒ½ì°½"},
        {"q": "ì§ˆëŸ‰ì´ ê°™ì„ ë•Œ ë¹„ì—´ì´ í° ë¬¼ì§ˆì¼ìˆ˜ë¡ ì˜¨ë„ë¥¼ ë†’ì´ëŠ” ë° ì—´ëŸ‰ì´ (ë§ì´/ì ê²Œ) ë“ ë‹¤.", "a": "ë§ì´"},
        {"q": "í•´ë¥™í’ì´ ë¶€ëŠ” ê·¼ë³¸ì ì¸ ì›ì¸ì€ í™ê³¼ ë¬¼ì˜ ë¬´ì—‡ ì°¨ì´ ë•Œë¬¸ì¸ê°€?", "a": "ë¹„ì—´"},
        {"q": "ë³´ì˜¨ë³‘ì˜ ì€ë„ê¸ˆ ëœ ë²½ì€ ì—´ì˜ ì´ë™ ë°©ë²• ì¤‘ ë¬´ì—‡ì„ ë§‰ê¸° ìœ„í•œ ê²ƒì¸ê°€?", "a": "ë³µì‚¬"}
    ],
    4: [ # ì¢…í•© ì‹¬í™” (ì¦ë¥˜íƒ‘, ì—´, í•´ë¥˜ ë“± ì‹¬í™” ë¬¸ì œ / ë‹¨ìˆœ ì •ì˜ X)
        {"q": "ì›ìœ ë¥¼ ë¶„ë¦¬í•˜ëŠ” ì¦ë¥˜íƒ‘ì€ ìœ„ìª½ìœ¼ë¡œ ê°ˆìˆ˜ë¡ ë“ëŠ”ì ì´ (ë†’ì€/ë‚®ì€) ë¬¼ì§ˆì´ ë‚˜ì˜¨ë‹¤.", "a": "ë‚®ì€"},
        {"q": "ë“ëŠ”ì  ì°¨ì´ë¥¼ ì´ìš©í•´ ì•¡ì²´ í˜¼í•©ë¬¼ì„ ë¶„ë¦¬í•  ë•Œ, ë“ì–´ ë‚˜ì˜¤ëŠ” ê¸°ì²´ë¥¼ ë‹¤ì‹œ ì•¡í™”ì‹œí‚¤ëŠ” ëƒ‰ê°ê¸°ì˜ ë¬¼ì€ (ìœ„/ì•„ë˜)ìª½ì—ì„œ ë„£ì–´ì•¼ í•˜ëŠ”ê°€?", "a": "ì•„ë˜"},
        {"q": "ë¶„ë³„ ê¹”ë•Œê¸°ì—ì„œ ì•„ë˜ì¸µ ì•¡ì²´ë¥¼ ë½‘ì•„ë‚¸ í›„, ìœ„ì¸µ ì•¡ì²´ëŠ” (ìœ„ìª½/ì•„ë˜ìª½)ìœ¼ë¡œ ë¶€ì–´ë‚´ì•¼ ì„ì´ì§€ ì•ŠëŠ”ë‹¤.", "a": "ìœ„ìª½"},
        {"q": "ë¬¼ê³¼ ì—íƒ„ì˜¬ì˜ ë¶„ë³„ ì¦ë¥˜ ê³¡ì„ ì—ì„œ ì˜¨ë„ê°€ ì¼ì •í•˜ê²Œ ìœ ì§€ë˜ëŠ” êµ¬ê°„ì€ ì´ ëª‡ êµ°ë°ì¸ê°€? (ìˆ«ìë§Œ)", "a": "2"},
        {"q": "ë‚œë¥˜ì™€ í•œë¥˜ê°€ ë§Œë‚˜ëŠ” ì¡°ê²½ ìˆ˜ì—­ì€ ì˜ì–‘ ì—¼ë¥˜ê°€ í’ë¶€í•˜ë‹¤. ìš°ë¦¬ë‚˜ë¼ëŠ” (ë‚¨í•´/ë™í•´/ì„œí•´)ì— í˜•ì„±ëœë‹¤.", "a": "ë™í•´"},
        {"q": "í•´ìˆ˜ìš•ì¥ì—ì„œ íŠœë¸Œë¥¼ íƒ€ê³  ë†€ ë•Œ ëª¸ì´ ë°”ë‹¤ ìª½ìœ¼ë¡œ ë°€ë ¤ê°€ëŠ” ì‹œê°„ëŒ€ëŠ”? (ë°€ë¬¼/ì°ë¬¼)", "a": "ì°ë¬¼"},
        {"q": "ë¹„ì—´ì´ í° ë¬¼ì§ˆì¼ìˆ˜ë¡ ê°€ì—´í•  ë•Œ ì˜¨ë„ê°€ (ë¹¨ë¦¬/ì²œì²œíˆ) ì˜¬ë¼ê°„ë‹¤.", "a": "ì²œì²œíˆ"},
        {"q": "ì—´íŒ½ì°½ì— ì˜í•´ ë‹¤ë¦¬(êµëŸ‰)ì˜ ë¶•ê´´ë¥¼ ë§‰ê¸° ìœ„í•´ ì„¤ì¹˜í•˜ëŠ” ë¹—ì‚´ë¬´ëŠ¬ ì´ìŒë§¤ì˜ ì´ë¦„ì€?", "a": "ì´ìŒì¥ì¹˜"},
        {"q": "ì‚¬ë§‰ì—ì„œ ë‚®ê³¼ ë°¤ì˜ ê¸°ì˜¨ ì°¨ê°€ ë§¤ìš° í° ì´ìœ ëŠ” ëª¨ë˜ì˜ ë¹„ì—´ì´ (í¬ê¸°/ì‘ê¸°) ë•Œë¬¸ì´ë‹¤.", "a": "ì‘ê¸°"},
        {"q": "ëƒ‰ì¥ê³  ë’·ë©´ì˜ ë°©ì—´íŒì€ ëƒ‰ë§¤ê°€ ê¸°ì²´ì—ì„œ ì•¡ì²´ë¡œ ë³€í•˜ë©° ì—´ì„ (ë°©ì¶œ/í¡ìˆ˜)í•˜ëŠ” ì›ë¦¬ë¥¼ ì´ìš©í•œë‹¤.", "a": "ë°©ì¶œ"},
        {"q": "ê°€ì—´ëœ í”„ë¼ì´íŒ¬ ìœ„ì— ë¬¼ì„ ë–¨ì–´ëœ¨ë¦¬ë©´ ë¬¼ë°©ìš¸ì´ í†µí†µ íŠ€ëŠ” í˜„ìƒì€ ë¬¼ì´ ê¸‰ê²©íˆ (ê¸°í™”)ë˜ì–´ ìˆ˜ì¦ê¸° ë§‰ì´ ìƒê¸°ê¸° ë•Œë¬¸ì´ë‹¤.", "a": "ê¸°í™”"},
        {"q": "ê²¨ìš¸ì²  í˜¸ìˆ˜ í‘œë©´ì˜ ì–¼ìŒì€ ë¬¼ì† ìƒë¬¼ë“¤ì—ê²Œ ì´ë¶ˆ ì—­í• ì„ í•˜ì—¬ ì—´ì˜ (ë°©ì¶œ)ì„ ë§‰ì•„ì¤€ë‹¤.", "a": "ë°©ì¶œ"},
        {"q": "í¬ë¡œë§ˆí† ê·¸ë˜í”¼ì—ì„œ ìš©ë§¤ê°€ ë‹¿ì§€ ì•Šë„ë¡ í•´ì•¼ í•˜ëŠ” ê²ƒì€?", "a": "ì "},
        {"q": "í˜¼í•©ë¬¼ì˜ ë“ëŠ”ì ì€ ìˆœë¬¼ì§ˆê³¼ ë‹¬ë¦¬ ì¼ì •í•˜ì§€ ì•Šê³  ê³„ì† (ì˜¬ë¼ê°„ë‹¤/ë‚´ë ¤ê°„ë‹¤).", "a": "ì˜¬ë¼ê°„ë‹¤"},
        {"q": "ì†Œê¸ˆë¬¼ì„ ê°€ì—´í•˜ë©´ ë¬¼ì´ ì¦ë°œí• ìˆ˜ë¡ ë†ë„ê°€ ì§„í•´ì ¸ ë“ëŠ”ì ì´ ì ì  (ë†’ì•„ì§„ë‹¤/ë‚®ì•„ì§„ë‹¤).", "a": "ë†’ì•„ì§„ë‹¤"}
    ]
}

# --- êµ¬ì—­ë³„ ë¹„ë°€ë²ˆí˜¸ (ë©”íƒ€ í¼ì¦: TEAM) ---
# 1êµ¬ì—­(PURITY) 5ë²ˆì§¸ ê¸€ì -> T
# 2êµ¬ì—­(OCEANS) 3ë²ˆì§¸ ê¸€ì -> E
# 3êµ¬ì—­(HEATER) 3ë²ˆì§¸ ê¸€ì -> A
# 4êµ¬ì—­(COLUMN) 5ë²ˆì§¸ ê¸€ì -> M (ì¦ë¥˜íƒ‘)
ZONE_INFO = {
    1: {"name": "1êµ¬ì—­: í˜¼í•©ë¬¼ ì—°êµ¬ì†Œ", "pw": "PURITY"},
    2: {"name": "2êµ¬ì—­: ì‹¬í•´ íƒì‚¬ì„ ", "pw": "OCEANS"},
    3: {"name": "3êµ¬ì—­: ì—´ ì œì–´ì‹¤", "pw": "HEATER"},
    4: {"name": "4êµ¬ì—­: ì¦ë¥˜íƒ‘ í†µì œì‹¤", "pw": "COLUMN"} # VOLUME -> COLUMN ë³€ê²½
}

# --- ì„¸ì…˜ ì´ˆê¸°í™” ---
if 'game_started' not in st.session_state:
    st.session_state.game_started = False
if 'lives' not in st.session_state:
    st.session_state.lives = 5
if 'hints_left' not in st.session_state:
    st.session_state.hints_left = 3
if 'cleared_zones' not in st.session_state:
    st.session_state.cleared_zones = [] # ì™„ë£Œí•œ êµ¬ì—­ ë²ˆí˜¸
if 'current_zone' not in st.session_state:
    st.session_state.current_zone = None
if 'zone_problems' not in st.session_state:
    st.session_state.zone_problems = {}
if 'zone_progress' not in st.session_state:
    st.session_state.zone_progress = {}

# --- ê²Œì„ ì´ˆê¸°í™”/ì¬ì‹œì‘ í•¨ìˆ˜ ---
def init_game():
    st.session_state.lives = 5
    st.session_state.hints_left = 3
    st.session_state.cleared_zones = []
    st.session_state.current_zone = None
    st.session_state.game_started = True
    
    st.session_state.zone_problems = {}
    st.session_state.zone_progress = {}
    
    for zid in range(1, 5):
        # 6ë¬¸ì œ ëœë¤ ì„ íƒ
        selected_qs = random.sample(PROBLEM_POOL[zid], 6)
        st.session_state.zone_problems[zid] = selected_qs
        st.session_state.zone_progress[zid] = [False] * 6

# =========================================================
# í™”ë©´ êµ¬ì„±
# =========================================================

# [ì‚¬ì´ë“œë°”]
with st.sidebar:
    st.header("ğŸ§¬ ìƒì¡´ í˜„í™©")
    st.metric("â¤ï¸ ë‚¨ì€ ìƒëª…", f"{st.session_state.lives} / 5")
    st.metric("ğŸ’¡ ë‚¨ì€ íŒíŠ¸", f"{st.session_state.hints_left} / 3")
    
    if st.button("ğŸ”„ ê²Œì„ ì¬ì‹œì‘"):
        init_game()
        st.rerun()
    
    st.divider()
    
    # 4ê°œ êµ¬ì—­ ëª¨ë‘ í´ë¦¬ì–´ ì‹œ ìª½ì§€ ë“±ì¥
    if len(st.session_state.cleared_zones) == 4:
        st.markdown("""
        <div class="secret-note">
            <h4>ğŸ“œ ë‚¡ì€ ìª½ì§€ ë°œê²¬</h4>
            <p>íƒˆì¶œêµ¬ì˜ ë¹„ë°€ë²ˆí˜¸ëŠ”...</p>
            <ul>
                <li>1êµ¬ì—­ì˜ <b>5ë²ˆì§¸</b> ê¸€ì</li>
                <li>2êµ¬ì—­ì˜ <b>3ë²ˆì§¸</b> ê¸€ì</li>
                <li>3êµ¬ì—­ì˜ <b>3ë²ˆì§¸</b> ê¸€ì</li>
                <li>4êµ¬ì—­ì˜ <b>5ë²ˆì§¸</b> ê¸€ì</li>
            </ul>
            <p>ìˆœì„œëŒ€ë¡œ ì¡°í•©í•˜ì‹œì˜¤.</p>
        </div>
        """, unsafe_allow_html=True)
    else:
        st.info(f"íƒˆì¶œ ì§„í–‰ë¥ : {len(st.session_state.cleared_zones)} / 4 êµ¬ì—­")

# [ë©”ì¸ í™”ë©´]

# 1. ê²Œì„ ì‹œì‘ ì „
if not st.session_state.game_started:
    st.title("ğŸ”’ ê³¼í•™ ë°©íƒˆì¶œ: ë¼ìŠ¤íŠ¸ ì½”ë“œ")
    st.write("íì‡„ëœ ì‹¤í—˜ì‹¤ì—ì„œ íƒˆì¶œí•˜ë ¤ë©´ 4ê°œ êµ¬ì—­ì˜ ì•”í˜¸ë¥¼ ëª¨ë‘ í•´ë…í•´ì•¼ í•©ë‹ˆë‹¤.")
    st.write("ê° êµ¬ì—­ì„ ì •ë³µí•˜ê³  ë§ˆì§€ë§‰ì— ë°œê²¬ë˜ëŠ” ìª½ì§€ì˜ ë¹„ë°€ì„ í‘¸ì„¸ìš”.")
    if st.button("ğŸš€ íƒˆì¶œ ì‹œì‘", use_container_width=True):
        init_game()
        st.rerun()

# 2. ê²Œì„ ì˜¤ë²„
elif st.session_state.lives <= 0:
    st.error("ğŸ’€ GAME OVER")
    st.markdown("### ìƒëª…ì´ ëª¨ë‘ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤.")
    if st.button("ğŸ”„ ë‹¤ì‹œ ë„ì „í•˜ê¸°", use_container_width=True):
        init_game()
        st.rerun()

# 3. ë¡œë¹„ (êµ¬ì—­ ì„ íƒ)
elif st.session_state.current_zone is None:
    st.title("ğŸ›ï¸ ì¤‘ì•™ ë¡œë¹„")
    st.write("íƒìƒ‰í•  êµ¬ì—­ì„ ì„ íƒí•˜ì„¸ìš”. ê° êµ¬ì—­ì„ í´ë¦¬ì–´í•˜ë©´ **ì•”í˜¸ ë‹¨ì–´**ê°€ ê³µê°œë©ë‹ˆë‹¤.")
    st.divider()
    
    col1, col2 = st.columns(2)
    for zid in range(1, 5):
        info = ZONE_INFO[zid]
        is_cleared = zid in st.session_state.cleared_zones
        target_col = col1 if zid % 2 != 0 else col2
        
        with target_col:
            with st.container(border=True):
                st.subheader(info['name'])
                if is_cleared:
                    st.success("âœ… CLEARED")
                    st.markdown(f"<div class='cleared-password'>{info['pw']}</div>", unsafe_allow_html=True)
                else:
                    if st.button(f"ì§„ì…í•˜ê¸°", key=f"enter_{zid}", use_container_width=True):
                        st.session_state.current_zone = zid
                        st.session_state.zone_q_idx = 0
                        st.rerun()
    
    # ìµœì¢… íƒˆì¶œ ì…ë ¥ì°½
    if len(st.session_state.cleared_zones) == 4:
        st.divider()
        st.markdown("### ğŸšª ë¹„ìƒ íƒˆì¶œêµ¬")
        st.write("ì˜¤ë¥¸ìª½ ìª½ì§€ì˜ ë‚´ìš©ì„ í•´ë…í•˜ì—¬ ìµœì¢… ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.")
        
        c1, c2 = st.columns([3, 1])
        with c1:
            final_code = st.text_input("ìµœì¢… ì½”ë“œ (4ê¸€ì)", key="final_code_input", label_visibility="collapsed")
        with c2:
            if st.button("íƒˆì¶œ ì‹œë„", use_container_width=True):
                # ì •ë‹µ: TEAM (PURITY 5th: T, OCEANS 3rd: E, HEATER 3rd: A, COLUMN 5th: M)
                if final_code.replace(" ", "").upper() == "TEAM":
                    st.balloons()
                    st.success("ğŸ‰ íƒˆì¶œ ì„±ê³µ! ê³¼í•™ ì‹¤í—˜ì‹¤ì„ ë¬´ì‚¬íˆ ë¹ ì ¸ë‚˜ì™”ìŠµë‹ˆë‹¤!")
                    st.image("https://media.giphy.com/media/26tOZ42Mg6pbTUPHW/giphy.gif")
                    st.stop()
                else:
                    st.error("âŒ ì½”ë“œê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. ìª½ì§€ë¥¼ ë‹¤ì‹œ í™•ì¸í•˜ì„¸ìš”!")

# 4. êµ¬ì—­ ë‚´ë¶€ (ë¬¸ì œ í’€ì´)
else:
    zid = st.session_state.current_zone
    info = ZONE_INFO[zid]
    password_chars = list(info['pw'])
    
    c1, c2, c3 = st.columns([1, 4, 1])
    with c1:
        if st.button("ğŸ”™ ë¡œë¹„ë¡œ"):
            st.session_state.current_zone = None
            st.rerun()
    with c2:
        st.markdown(f"<h3 style='text-align:center'>{info['name']}</h3>", unsafe_allow_html=True)
    
    # ì•”í˜¸ í•´ë… í˜„í™©
    display_chars = []
    for i in range(6):
        if st.session_state.zone_progress[zid][i]:
            display_chars.append(f"[{password_chars[i]}]")
        else:
            display_chars.append("[ğŸ”’]")
    
    st.markdown(f"<h2 style='text-align:center; color:#00ADB5'>{' '.join(display_chars)}</h2>", unsafe_allow_html=True)
    st.progress(sum(st.session_state.zone_progress[zid]) / 6)
    st.divider()
    
    if 'zone_q_idx' not in st.session_state:
        st.session_state.zone_q_idx = 0
        
    q_idx = st.session_state.zone_q_idx
    problems = st.session_state.zone_problems[zid]
    current_p = problems[q_idx]
    
    # ë¬¸ì œ ì´ë™
    bc1, bc2, bc3 = st.columns([1, 4, 1])
    with bc1:
        if st.button("â—€ ì´ì „"):
            st.session_state.zone_q_idx = max(0, q_idx - 1)
            st.rerun()
    with bc2:
        st.markdown(f"<h4 style='text-align:center'>ë¬¸ì œ {q_idx + 1} / 6</h4>", unsafe_allow_html=True)
    with bc3:
        if st.button("ë‹¤ìŒ â–¶"):
            st.session_state.zone_q_idx = min(5, q_idx + 1)
            st.rerun()
            
    is_solved = st.session_state.zone_progress[zid][q_idx]
    
    if is_solved:
        st.success(f"âœ… í•´ê²° ì™„ë£Œ! ì•”í˜¸ ê¸€ì: {password_chars[q_idx]}")
        st.info(f"ì •ë‹µ: {current_p['a']}")
    else:
        st.markdown(f"**Q. {current_p['q']}**")
        
        if st.button("ğŸ’¡ íŒíŠ¸ ë³´ê¸° (ì´ë¡  ì„¤ëª…)"):
            if st.session_state.hints_left > 0:
                st.session_state.hints_left -= 1
                st.info("ğŸ’¡ ë„ì–´ì“°ê¸° ì—†ì´ í•µì‹¬ ìš©ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”. (ì˜ˆ: ë¶„ë³„ê¹”ë•Œê¸°)")
            else:
                st.toast("ë‚¨ì€ íŒíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤!", icon="ğŸš«")
        
        with st.form(key=f"form_{zid}_{q_idx}"):
            user_input = st.text_input("ì •ë‹µ ì…ë ¥ (ë„ì–´ì“°ê¸° ë¬´ì‹œ)", key=f"input_{zid}_{q_idx}")
            if st.form_submit_button("í™•ì¸"):
                clean_input = user_input.replace(" ", "")
                clean_ans = current_p['a'].replace(" ", "")
                
                if clean_input == clean_ans:
                    st.toast("ì •ë‹µ! ì•”í˜¸ ê¸€ì íšë“!", icon="ğŸ”“")
                    st.session_state.zone_progress[zid][q_idx] = True
                    
                    if all(st.session_state.zone_progress[zid]):
                        if zid not in st.session_state.cleared_zones:
                            st.session_state.cleared_zones.append(zid)
                        st.balloons()
                        st.success(f"{info['name']} íƒˆì¶œ ì„±ê³µ! ë¡œë¹„ë¡œ ì´ë™í•©ë‹ˆë‹¤.")
                        time.sleep(2)
                        st.session_state.current_zone = None
                        st.rerun()
                    else:
                        st.rerun()
                else:
                    st.session_state.lives -= 1
                    st.toast(f"ì˜¤ë‹µì…ë‹ˆë‹¤! ìƒëª… -1 (ë‚¨ì€ ìƒëª…: {st.session_state.lives})", icon="ğŸ’”")
                    if st.session_state.lives <= 0:
                        st.rerun()